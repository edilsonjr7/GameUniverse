<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Minha Biblioteca | GameStream Universe</title>
    <link rel="stylesheet" href="estilo.css">
    <style>
        /* Estilos básicos para a biblioteca */
        .biblioteca-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .biblioteca-card {
            background-color: #4a1975;
            width: 280px;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            text-align: left; /* Alinhamento do conteúdo dentro do card */
        }
        .biblioteca-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .biblioteca-card h3 {
            color: #c77dff;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .biblioteca-card p {
            font-size: 0.9rem;
            color: #ddd;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <a href="index.html" style="color: white; text-decoration: none;">&larr; Voltar à Loja</a>
    </header>

    <main>
        <h1 style="text-align: center; margin-top: 40px;">Meus Jogos (Biblioteca)</h1>
        <p style="text-align: center; color: #a050ff;" id="status-biblioteca">Carregando seus jogos...</p>
        <div id="biblioteca-jogos" class="biblioteca-container">
            </div>
    </main>

<script>
const token = localStorage.getItem('userToken');
const userData = JSON.parse(localStorage.getItem('userData'));
const jogosContainer = document.getElementById('biblioteca-jogos');
const statusElement = document.getElementById('status-biblioteca');

// 1. Verifica se o usuário está logado
if (!token || !userData) {
    alert("Você precisa estar logado para ver sua biblioteca.");
    window.location.href = 'EscolherPerfil.html';
}

// 2. Função para carregar os jogos do servidor
async function loadLibrary() {
    try {
        statusElement.textContent = 'Buscando jogos no servidor...';
        
        // Chamada para a nova rota no backend
        const response = await fetch('/api/compra/biblioteca', {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const resultado = await response.json();
        jogosContainer.innerHTML = ''; 

        if (response.ok && resultado.jogos && resultado.jogos.length > 0) {
            statusElement.textContent = '';
            
            resultado.jogos.forEach(jogo => {
                const card = document.createElement('div');
                card.className = 'biblioteca-card';
                card.innerHTML = `
                    <img src="${jogo.imageUrl}" alt="Capa do Jogo ${jogo.titulo}">
                    <h3>${jogo.titulo}</h3>
                    <p>Gênero: ${jogo.genero}</p>
                    <p>Comprado em: ${new Date(jogo.dataCompra).toLocaleDateString('pt-BR')}</p>
                    <button style="margin-top: 10px; background-color: #a050ff; border: none; padding: 10px; color: white; border-radius: 5px; cursor: pointer; width: 100%;">Jogar</button>
                `;
                jogosContainer.appendChild(card);
            });
        } else {
             // Caso a resposta seja OK, mas a lista esteja vazia
            statusElement.textContent = resultado.message || 'Sua biblioteca está vazia. Compre alguns jogos!';
        }

    } catch (error) {
        statusElement.textContent = 'Erro ao conectar com o servidor para buscar a biblioteca.';
        console.error(error);
    }
}

// 3. Inicializa o carregamento
loadLibrary();
</script>
</body>
</html>